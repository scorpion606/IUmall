<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scorpion.mapper.ProductMapper">
  <!--Product映射关系-->
  <resultMap id="BaseResultMap" type="com.scorpion.entity.Product">
    <id column="product_id" jdbcType="INTEGER" property="productId" />
    <result column="category_id" jdbcType="INTEGER" property="categoryId" />
    <result column="root_category_id" jdbcType="INTEGER" property="rootCategoryId" />
    <result column="nav_id" jdbcType="INTEGER" property="navId" />
    <result column="tab_id" jdbcType="INTEGER" property="tabId" />
    <result column="product_name" jdbcType="VARCHAR" property="productName" />
    <result column="share_url" jdbcType="VARCHAR" property="shareUrl" />
    <result column="product_unit" jdbcType="VARCHAR" property="productUnit" />
    <result column="sold_num" jdbcType="INTEGER" property="soldNum" />
    <result column="product_status" jdbcType="INTEGER" property="productStatus" />
    <result column="approve_status" jdbcType="INTEGER" property="approveStatus"/>
    <result column="approve_content" jdbcType="VARCHAR" property="approveContent"/>
    <result column="key_word" jdbcType="VARCHAR" property="keyWord" />
    <result column="REVISION" jdbcType="INTEGER" property="revision" />
    <result column="CREATED_BY" jdbcType="VARCHAR" property="createdBy" />
    <result column="CREATED_TIME" jdbcType="TIMESTAMP" property="createdTime" />
    <result column="UPDATED_BY" jdbcType="VARCHAR" property="updatedBy" />
    <result column="UPDATED_TIME" jdbcType="TIMESTAMP" property="updatedTime" />
    <result column="product_content" jdbcType="LONGVARCHAR" property="productContent" />
  </resultMap>

  <!--Product-ProductImg-product-sku映射关系-->
  <resultMap id="ProductVoMap" type="com.scorpion.entity.ProductVo">
    <id column="product_id" jdbcType="INTEGER" property="productId" />
    <result column="category_id" jdbcType="INTEGER" property="categoryId" />
    <result column="root_category_id" jdbcType="INTEGER" property="rootCategoryId" />
    <result column="nav_id" jdbcType="INTEGER" property="navId" />
    <result column="tab_id" jdbcType="INTEGER" property="tabId" />
    <result column="product_name" jdbcType="VARCHAR" property="productName" />
    <result column="share_url" jdbcType="VARCHAR" property="shareUrl" />
    <result column="product_unit" jdbcType="VARCHAR" property="productUnit" />
    <result column="approve_status" jdbcType="INTEGER" property="approveStatus"/>
    <result column="approve_content" jdbcType="VARCHAR" property="approveContent"/>
    <result column="sold_num" jdbcType="INTEGER" property="soldNum" />
    <result column="product_status" jdbcType="INTEGER" property="productStatus" />
    <result column="key_word" jdbcType="VARCHAR" property="keyWord" />
    <result column="REVISION" jdbcType="INTEGER" property="revision" />
    <result column="CREATED_BY" jdbcType="VARCHAR" property="createdBy" />
    <result column="CREATED_TIME" jdbcType="TIMESTAMP" property="createdTime" />
    <result column="UPDATED_BY" jdbcType="VARCHAR" property="updatedBy" />
    <result column="UPDATED_TIME" jdbcType="TIMESTAMP" property="updatedTime" />
    <result column="product_content" jdbcType="LONGVARCHAR" property="productContent" />
    <collection property="productImgs" select="com.scorpion.mapper.ProductImgMapper.selectProductImgsByProductId" column="product_id">

    </collection>
    <collection property="productSkus" select="com.scorpion.mapper.ProductSkuMapper.selectProductSkuByPid" column="product_id">

    </collection>
  </resultMap>

    <!--Product-ProductImg-ProductSku映射关系-->
  <resultMap id="ProductVo2Map" type="com.scorpion.entity.ProductVo">
    <id column="product_id" jdbcType="INTEGER" property="productId" />
    <result column="category_id" jdbcType="INTEGER" property="categoryId" />
    <result column="root_category_id" jdbcType="INTEGER" property="rootCategoryId" />
    <result column="nav_id" jdbcType="INTEGER" property="navId" />
    <result column="tab_id" jdbcType="INTEGER" property="tabId" />
    <result column="product_name" jdbcType="VARCHAR" property="productName" />
    <result column="share_url" jdbcType="VARCHAR" property="shareUrl" />
    <result column="product_unit" jdbcType="VARCHAR" property="productUnit" />
    <result column="approve_status" jdbcType="INTEGER" property="approveStatus"/>
    <result column="approve_content" jdbcType="VARCHAR" property="approveContent"/>
    <result column="sold_num" jdbcType="INTEGER" property="soldNum" />
    <result column="product_status" jdbcType="INTEGER" property="productStatus" />
    <result column="key_word" jdbcType="VARCHAR" property="keyWord" />
    <result column="REVISION" jdbcType="INTEGER" property="revision" />
    <result column="CREATED_BY" jdbcType="VARCHAR" property="createdBy" />
    <result column="CREATED_TIME" jdbcType="TIMESTAMP" property="createdTime" />
    <result column="UPDATED_BY" jdbcType="VARCHAR" property="updatedBy" />
    <result column="UPDATED_TIME" jdbcType="TIMESTAMP" property="updatedTime" />
    <result column="product_content" jdbcType="LONGVARCHAR" property="productContent" />
    <collection property="productImgs" select="com.scorpion.mapper.ProductImgMapper.selectProductImgsByProductId" column="product_id">
    </collection>
    <collection property="productSkus" select="com.scorpion.mapper.ProductSkuMapper.selectProductSkuByProductId" column="product_id">
    </collection>
  </resultMap>

  <!--Product-ProductImg映射关系-->
  <resultMap id="ProductToProductImgMap" type="com.scorpion.entity.ProductToProductImgVo">
    <id column="product_id" jdbcType="INTEGER" property="productId" />
    <result column="category_id" jdbcType="INTEGER" property="categoryId" />
    <result column="root_category_id" jdbcType="INTEGER" property="rootCategoryId" />
    <result column="nav_id" jdbcType="INTEGER" property="navId" />
    <result column="tab_id" jdbcType="INTEGER" property="tabId" />
    <result column="product_name" jdbcType="VARCHAR" property="productName" />
    <result column="share_url" jdbcType="VARCHAR" property="shareUrl" />
    <result column="product_unit" jdbcType="VARCHAR" property="productUnit" />
    <result column="approve_status" jdbcType="INTEGER" property="approveStatus"/>
    <result column="approve_content" jdbcType="VARCHAR" property="approveContent"/>
    <result column="sold_num" jdbcType="INTEGER" property="soldNum" />
    <result column="product_status" jdbcType="INTEGER" property="productStatus" />
    <result column="key_word" jdbcType="VARCHAR" property="keyWord" />
    <result column="REVISION" jdbcType="INTEGER" property="revision" />
    <result column="CREATED_BY" jdbcType="VARCHAR" property="createdBy" />
    <result column="CREATED_TIME" jdbcType="TIMESTAMP" property="createdTime" />
    <result column="UPDATED_BY" jdbcType="VARCHAR" property="updatedBy" />
    <result column="UPDATED_TIME" jdbcType="TIMESTAMP" property="updatedTime" />
    <result column="product_content" jdbcType="LONGVARCHAR" property="productContent" />
    <collection property="productImgs" select="com.scorpion.mapper.ProductImgMapper.selectProductImgsByProductId" column="product_id">
    </collection>
  </resultMap>
  <!--查询最新上架的前八个商品-->
    <select id="selectRecommendProductions" resultMap="ProductVo2Map">
      select
        product_id,
        category_id,
        root_category_id,
        nav_id,
        tab_id,
        product_name,
        share_url,
        product_unit,
        approve_status,
        approve_content,
        sold_num,
        product_status,
        key_word,
        REVISION,
        CREATED_BY,
        CREATED_TIME,
        UPDATED_BY,
        UPDATED_TIME,
        product_content
      from
        product
      where
        product_status=1
      order by
        CREATED_TIME
      desc
      limit 0,8
    </select>

  <!--查询每个一级分类下的销量前10的商品-->
    <select id="selectTopSexProductions" resultMap="ProductVoMap">
      select
        product_id,
        category_id,
        root_category_id,
        nav_id,
        tab_id,
        product_name,
        share_url,
        product_unit,
        approve_status,
        approve_content,
        sold_num,
        product_status,
        key_word,
        REVISION,
        CREATED_BY,
        CREATED_TIME,
        UPDATED_BY,
        UPDATED_TIME,
        product_content
      from
        Product
      where
        root_category_id=#{categoryId}
      and
        product_status=1
      order by
        sold_num
      desc
      limit 0 , 10
    </select>

  <!--查询某个三级分类下的商品-->
    <select id="selectCategoryProducts" resultMap="ProductVo2Map">
    select
      product_id,
      category_id,
      root_category_id,
      nav_id,
      tab_id,
      product_name,
      share_url,
      product_unit,
      approve_status,
      approve_content,
      sold_num,
      product_status,
      key_word,
      REVISION,
      CREATED_BY,
      CREATED_TIME,
      UPDATED_BY,
      UPDATED_TIME,
      product_content
    from
      product
    where
      category_id=#{categoryId}
    limit #{start},#{limit}
    </select>

  <!--根据分类ID查询商品品牌-->
  <select id="selectBrandByCategoryId" resultType="java.lang.String" resultSets="java.util.List">
    select
        brand
    from
        product_params
    where
        product_id
    in(
        select
            product_id
        from
            product
        where
            category_id=#{categotyId}
        )
  </select>

  <!--根据关键词查询商品-->
  <select id="selectProductByKeyWord" resultMap="ProductVo2Map">
    SELECT
      product_id,
      category_id,
      root_category_id,
      nav_id,
      tab_id,
      product_name,
      share_url,
      product_unit,
      approve_status,
      approve_content,
      sold_num,
      product_status,
      key_word,
      REVISION,
      CREATED_BY,
      CREATED_TIME,
      UPDATED_BY,
      UPDATED_TIME,
      product_content
    FROM
        product
    WHERE
        product_content
    LIKE
        #{keyWord}
    OR
        product_name
    LIKE
        #{keyWord}
    <if test="start!=null and limit!=null">
    limit #{start},#{limit}
    </if>
  </select>

  <select id="selectProductToEs" resultMap="ProductVo2Map">
    SELECT
      product_id,
      category_id,
      root_category_id,
      nav_id,
      tab_id,
      product_name,
      share_url,
      product_unit,
      approve_status,
      approve_content,
      sold_num,
      product_status,
      key_word,
      REVISION,
      CREATED_BY,
      CREATED_TIME,
      UPDATED_BY,
      UPDATED_TIME,
      product_content
    FROM
      product
  </select>

  <!--根据关键词查询商品品牌-->
  <select id="selectBrandByKeyWord" resultType="java.lang.String" resultSets="java.util.List">
    SELECT
        brand
    FROM
        product_params
    WHERE
        product_id
    IN(
        SELECT
            product_id
        FROM
            product
        WHERE
            product_content
        LIKE
            #{keyWord}
        OR
            product_name
        LIKE
            #{keyWord}
        )
  </select>
  <!--根据分类ID查询商品信息-->
  <select id="selectSwitchProduct" resultMap="ProductVo2Map">
    SELECT
      product_id,
      category_id,
      root_category_id,
      nav_id,
      tab_id,
      product_name,
      share_url,
      product_unit,
      approve_status,
      approve_content,
      sold_num,
      product_status,
      key_word,
      REVISION,
      CREATED_BY,
      CREATED_TIME,
      UPDATED_BY,
      UPDATED_TIME,
      product_content
    FROM
      product
    WHERE
      product_status=1
    AND
      nav_id=#{categoryId}
    ORDER BY
      sold_num
    DESC
    limit #{start},#{limit}
  </select>
  <select id="selectProductBypId" resultMap="BaseResultMap">
    SELECT
      product_id,
      category_id,
      root_category_id,
      nav_id,
      tab_id,
      product_name,
      share_url,
      product_unit,
      approve_status,
      approve_content,
      sold_num,
      product_status,
      key_word,
      REVISION,
      CREATED_BY,
      CREATED_TIME,
      UPDATED_BY,
      UPDATED_TIME,
      product_content
    FROM
      product
    WHERE
      product_status=1
    AND
      product_id=#{productId}
  </select>
  <select id="selectProductToProductImg" resultMap="ProductToProductImgMap">
    SELECT
      product_id,
      category_id,
      root_category_id,
      nav_id,
      tab_id,
      product_name,
      share_url,
      product_unit,
      approve_status,
      approve_content,
      sold_num,
      product_status,
      key_word,
      REVISION,
      CREATED_BY,
      CREATED_TIME,
      UPDATED_BY,
      UPDATED_TIME,
      product_content
    FROM
      product
    WHERE
      product_status=1
      AND
      product_id=#{productId}
  </select>
  <select id="selectProductByProductId" resultMap="ProductVo2Map">
    SELECT
      product_id,
      category_id,
      root_category_id,
      nav_id,
      tab_id,
      product_name,
      share_url,
      product_unit,
      approve_status,
      approve_content,
      sold_num,
      product_status,
      key_word,
      REVISION,
      CREATED_BY,
      CREATED_TIME,
      UPDATED_BY,
      UPDATED_TIME,
      product_content
    FROM
      product
    WHERE
      product_id=#{productId}
    and
      product_status=1
  </select>

</mapper>